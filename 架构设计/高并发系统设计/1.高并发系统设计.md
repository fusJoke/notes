#### 高并发的通用方法

+ 横向扩展：分布式部署把流量分流开，让每个服务器都承担一部分并发和流量
+ 缓存：使用缓存来提供系统的性能
+ 异步：未完成处理，先让请求返回；后续将结果提交



#### 架构分层

<img src="/Users/wangfusheng/Documents/notes/架构设计/高并发系统设计/.assets/image-20221224090923832.png" alt="image-20221224090923832" style="zoom:33%;" /> 

- 终端显示层：各端模板渲染并执行显示的层。当前主要是 Velocity 渲染，JS 渲染， JSP 渲染，移动端展示等。
- 开放接口层：将 Service 层方法封装成开放接口，同时进行网关安全控制和流量控制等。
- Web 层：主要是对访问控制进行转发，各类基本参数校验，或者不复用的业务简单处理等。
- Service 层：业务逻辑层。
- Manager 层：通用业务处理层。这一层主要有两个作用，其一，你可以将原先 Service 层的一些通用能力下沉到这一层，比如与缓存和存储交互策略，中间件的接入；其二，你也可以在这一层封装对第三方接口的调用，比如调用支付服务，调用审核服务等。
- DAO 层：数据访问层，与底层 MySQL、Oracle、Hbase 等进行数据交互。
- 外部接口或第三方平台：包括其它部门 RPC 开放接口，基础平台，其它公司的 HTTP 接口。



### 高性能，高可用，可扩展



#### 性能优化的指标

+ 平均值
+ 最大值
+ 分位值

#### 高并发下的性能优化

1. 提高系统的处理的核心数

   ```
   (Ws + Wp) / (Ws + Wp/s)
   ```

   Ws 表示任务中的串行计算量，Wp 表示任务中的并行计算量，s 表示并行进程数

   ```
   1/(1-p+p/s)
   ```

   <img src="/Users/wangfusheng/Documents/notes/架构设计/高并发系统设计/.assets/image-20221224092241109.png" alt="image-20221224092241109" style="zoom: 33%;" />  

2. 减少单次任务响应时间
   CPU 密集型系统中，需要处理大量的 CPU 运算，那么选用更高效的算法或者减少运算次数就是这类系统重要的优化手段。
   IO 密集型系统指的是系统的大部分操作是在等待 IO 完成，这里 IO 指的是磁盘 IO 和网络 IO。



#### 如何做到高可用

#### 可用性的度量

**MTBF（Mean Time Between Failure）**是平均故障间隔的意思，代表两次故障的间隔时间，也就是系统正常运转的平均时间。这个时间越长，系统稳定性越高。

**MTTR（Mean Time To Repair）**表示故障的平均恢复时间，也可以理解为平均故障时间。这个值越小，故障对于用户的影响越小。



#### 高可用系统设计的思路

1. 系统设计
   **failover（故障转移）、超时控制以及降级和限流。**
   + 故障转移
   + 系统间调用超时的控制
   + 降级是为了保证核心服务的稳定而牺牲非核心服务的做法



#### 如何系统易于扩展

#### 高扩展的设计思路

庞杂的系统拆分成独立的，有单一职责的模块。

##### 1. 存储层的扩展性

<img src="/Users/wangfusheng/Documents/notes/架构设计/高并发系统设计/.assets/image-20221224093740908.png" alt="image-20221224093740908" style="zoom: 33%;" /> 

#### 2. 业务层的扩展性

<img src="/Users/wangfusheng/Documents/notes/架构设计/高并发系统设计/.assets/image-20221224093911071.png" alt="image-20221224093911071" style="zoom:33%;" /> 

