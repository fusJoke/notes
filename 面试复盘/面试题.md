# 如何避免订单重复提交和支付

1.前端防抖

前端控制间隔n毫秒内只会执行一次。

2.后端token机制

进入跳到支付页面的时候，针对订单生成一个token。token只能使用一次，用完就删除。借助lua脚本和分布式锁，从redis获取令牌，对比令牌，生成订单号，删除令牌。

3.订单号支付幂等

一、分布式锁，保证同一个订单同一个时间只有一个线程在处理。
二、验证订单的状态，防止重复支付。
三、支付完成会有回调。因为异常没有接收到回调。主动去查询第三方订单支付的状态。

