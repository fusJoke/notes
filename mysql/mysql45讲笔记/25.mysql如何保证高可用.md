#### 什么是主备延迟

主备延迟，就是同一个事务，在备库执行完成的时间和主库执行完成的时间之间的差值

#### 主备延迟的来源

备库机器性能差，更新过程兼顾大量读请求，备库主机上多个备库争抢资源导致主备延迟。

备库压力大，运营后台分析语句，读能力。

大事务

解决方案，一主多从或者binlog输出到外部系统hadoop

不要一次性使用delete删除太多数据。

### 主备切换

1. 判断备库B现在的second_behind_master,如果小于某个值则进行下一步。否则重试
2. 主库设置为只读状态
3. 等待备库B的second_behind_master等于0
4. 将备库设置成可读写
5. 把业务请求切换到B



