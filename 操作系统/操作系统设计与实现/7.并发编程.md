线程

1. 要保持线程的上下文状态，保持寄存器状态，调用syscall进入操作系统内核，选择一个线程进行切换，可能会涉及页的中断，内存置换
2. 阻塞的时候进行切换



协程

1. 在某个时刻，一个线程只能跑一个线程；如果一个协程阻塞，同一个线程上协程也会进入阻塞。

2. 开启一个线程需要8k的逻辑内存；协程则要小得多，goroutine则是1k
2. 协程的切换也是栈、寄存器的切换；但是切换的寄存器的数量比较少。



go的goroutine是线程和协程的混合

1. 每个cpu上面都绑定一个线程，叫machine，简写M

2. 将阻塞的系统调用改成non-block版本(read-no-block, sleep,等)

   + 没有阻塞就继续执行
   + 阻塞，切换到另一个协程进行执行。

3. 生产者-消费者解决大部分的问题，提供一个api不就解决了吗？

   channel



go的goroutine阻塞切换

